# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: vlad <vlad@student.42.fr>                  +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/12/29 13:31:53 by vbleskin          #+#    #+#              #
#    Updated: 2026/02/27 12:36:42 by vlad             ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

ifndef VERBOSE
.SILENT:
endif

SHELL			=	zsh

# ------------------------------------------------------------------------------
# exe
# ------------------------------------------------------------------------------

NAME			=	fdf

# ------------------------------------------------------------------------------
# dir
# ------------------------------------------------------------------------------

SRC_DIR			=	src

OBJ_DIR			=	obj

PARS_DIR		=	parser
P_FBX_DIR		=	$(PARS_DIR)/parse_fbx
P_OBJ_DIR		=	$(PARS_DIR)/parse_obj
P_FDF_DIR		=	$(PARS_DIR)/parse_fdf
ANIM_DIR		=	animation
REND_DIR		=	render
PROJ_DIR		=	$(REND_DIR)/projection
RAST_DIR		=	$(REND_DIR)/rasterization
WORLD_DIR		=	$(REND_DIR)/world
UI_DIR			=	user_interface
EVENT_DIR		=	events
MATHS_DIR		=	maths
UTIL_DIR		=	utils

SUB_DIRS		=	$(PARS_DIR) \
						$(P_FBX_DIR) \
							$(P_FBX_DIR)/connections \
							$(P_FBX_DIR)/objects \
						$(P_OBJ_DIR) \
						$(P_FDF_DIR) \
					$(ANIM_DIR) \
					$(REND_DIR) \
						$(RAST_DIR) \
						$(PROJ_DIR) \
						$(WORLD_DIR) \
					$(UI_DIR) \
					$(EVENT_DIR) \
					$(MATHS_DIR) \
					$(UTIL_DIR) \

LIB_DIR			=	lib

LIBFT_DIR		=	$(LIB_DIR)/libft/

MINLIB_DIR		=	$(LIB_DIR)/minilibx-linux/

# ------------------------------------------------------------------------------
# files
# ------------------------------------------------------------------------------

SRC				=	$(wildcard $(SRC_DIR)/*.c) \
					$(foreach dir, $(SUB_DIRS), $(wildcard $(SRC_DIR)/$(dir)/*.c))

OBJ				=	$(patsubst $(SRC_DIR)/%.c, $(OBJ_DIR)/%.o, $(SRC))

# ------------------------------------------------------------------------------
# flags
# ------------------------------------------------------------------------------

MAKEFLAGS 		+=	--no-print-directory
MAKEFLAGS		+=	j8

CFLAGS			=	-Wall -Wextra -Werror -O3 -pthread -march=native -ffast-math

CPPFLAGS		=	-I includes -I $(LIBFT_DIR)/includes -I $(MINLIB_DIR)

VALGRIND		=	-g3

INCLUDE_LIB		=	-L$(LIBFT_DIR) -lft -L$(MINLIB_DIR) -lmlx_Linux -lXext -lX11 -lm -lz

INCLUDE			=	-I includes -I $(LIBFT_DIR)/includes -I $(MINLIB_DIR)

# ------------------------------------------------------------------------------
# colors
# ------------------------------------------------------------------------------

RED				=	\033[31;1m

BLU				=	\033[34;1m

CYAN			=	\033[36;1m

PUR				=	\033[35;1m

END				=	\033[0m

purp 			=	/033[0m

# ------------------------------------------------------------------------------
# rules
# ------------------------------------------------------------------------------

all:			$(NAME)

$(OBJ_DIR)/%.o:	$(SRC_DIR)/%.c $(wildcard includes/*.h)
				@mkdir -p $(dir $@)
				@$(CC) $(CFLAGS) $(CPPFLAGS) -c $< -o $@

$(NAME):		$(OBJ)
	@make -C $(LIBFT_DIR) > /dev/null 2>&1
	@make -C $(MINLIB_DIR) > /dev/null 2>&1
	@echo -en "\xe2\x94\x8f\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x81\xe2\x94\x93"
	@echo -en "\xe2\x94\x83$(CYAN)      lib compiled without any issues ðŸ”¨, "
	@echo -e "now compiling the sources ðŸ”§ $(END)\xe2\x94\x83"
	@echo -en "\xe2\x94\x97\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81"
	@echo -en "$(END)$(PUR)|lib ready ðŸ› ï¸  |$(END)"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x81\xe2\x94\x9b"
	@cc -g $(OBJ) $(INCLUDE_LIB) $(CFLAGS) $(CPPFLAGS) -o $(NAME)
	@echo -en "\xe2\x94\x8f\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x81\xe2\x94\x93"
	@echo -en "\xe2\x94\x83$(CYAN)                      everything ok, "
	@echo -e "ready to use ðŸŒ©ï¸                    $(END)\xe2\x94\x83"
	@echo -en "\xe2\x94\x97\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "$(END)$(PUR)|binary ready â›ˆï¸  |$(END)"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x81\xe2\x94\x9b"

debug:			$(OBJ)
	@make -C $(LIBFT_DIR) > /dev/null 2>&1
	@make -C $(MINLIB_DIR) > /dev/null 2>&1
	@cc -g $(OBJ) $(INCLUDE_LIB) $(CFLAGS) $(CPPFLAGS) -o $(NAME) $(VALGRIND)

clean:
	@echo -en "\xe2\x94\x8f\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94"
	@echo -en "\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x81\xe2\x94\x93"
	@echo -en "\xe2\x94\x83$(CYAN)                          Cleaning ..."
	@echo -e "  ðŸŒ¨ï¸                               $(END)\xe2\x94\x83"
	@make clean -C $(LIBFT_DIR)
	@make clean -C $(MINLIB_DIR) > /dev/null 2>&1 || true
	@rm -rf $(OBJ_DIR)
	@echo -en "\xe2\x94\x97\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "$(END)$(PUR)|ðŸ”„|$(END)"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -en "\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81\xe2\x94\x81"
	@echo -e "\xe2\x94\x9b"

fclean: 		clean
	@rm -rf $(NAME)
	@make fclean -C $(LIBFT_DIR)
	# @echo "\033[1;35]cleaned all ðŸš½\033[0m"

re: 			fclean all

.PHONY:			all clean fclean re